2021-06-08  :55:49 - ERROR - user_info.py - 37 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-18' (18387), thread 'MainThread' (4507235776):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x107c61430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x107aee280>
           └ <SpawnProcess name='SpawnProcess-18' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x107ae08b0>
    └ <SpawnProcess name='SpawnProcess-18' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x107ce80a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-18' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-18' parent=15698 started>
    │    └ <function subprocess_started at 0x107c84ca0>
    └ <SpawnProcess name='SpawnProcess-18' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x107ce8040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x107c83e50>
    │    │                  └ <uvicorn.server.Server object at 0x107ce8040>
    │    └ <function BaseEventLoop.run_until_complete at 0x10826e700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10826e670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1082711f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1081c7550>
    └ <Handle <TaskWakeupMethWrapper object at 0x10a634220>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x10a634220>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x10a634220>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x10a634220>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1086cc700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x1086cc790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108665be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10a572bb0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108665be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10a5784f0>
          └ <fastapi.applications.FastAPI object at 0x10a572bb0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10a583ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x10a578550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10a5784f0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10a583ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10a578580>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x10a578550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10a583d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10a5780a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10a578580>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10a583d30>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x109421dc0>
          └ <fastapi.routing.APIRoute object at 0x10a5883d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10a583d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a5a55b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x10a583550>
          └ <fastapi.routing.APIRoute object at 0x10a5883d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10a5a5190>
                     └ <function get_request_handler.<locals>.app at 0x10a5834c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10940ed30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x10a5a5730>, 'request': <starlette.requests.Request object at 0x10a5...
                 │         └ <function avatar_upload at 0x10a555820>
                 └ <fastapi.dependencies.models.Dependant object at 0x10a5884c0>

> File "./app/api/user_info.py", line 37, in avatar_upload
    avatar_db.save_img(user_id, avatar)
    │         │        │        └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │        └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x10a00e160>
    └ <utils.services.db.mongodb.MongoDB object at 0x10a54ff40>

  File "./utils/services/db/mongodb.py", line 146, in save_img
    save_data = base64.b64encode(bson.binary.Binary(img.getvalue())).decode('ascii')
                │      │         │    │      │      └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
                │      │         │    │      └ <class 'bson.binary.Binary'>
                │      │         │    └ <module 'bson.binary' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/binary.py'>
                │      │         └ <module 'bson' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/__init__.py'>
                │      └ <function b64encode at 0x107d7bee0>
                └ <module 'base64' from '/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/base64.py'>

AttributeError: 'bytes' object has no attribute 'getvalue'
2021-06-08  :00:48 - ERROR - user_info.py - 38 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-23' (18504), thread 'MainThread' (4488799680):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x108897430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x108724280>
           └ <SpawnProcess name='SpawnProcess-23' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1087218b0>
    └ <SpawnProcess name='SpawnProcess-23' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10891e0a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-23' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-23' parent=15698 started>
    │    └ <function subprocess_started at 0x1088baca0>
    └ <SpawnProcess name='SpawnProcess-23' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10891e040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x1088ade50>
    │    │                  └ <uvicorn.server.Server object at 0x10891e040>
    │    └ <function BaseEventLoop.run_until_complete at 0x108ea5700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x108ea5670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x108ea81f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x108dfd550>
    └ <Handle <TaskWakeupMethWrapper object at 0x10b275220>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x10b275220>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x10b275220>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x10b275220>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x109302700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x109302790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10929bbe0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10b1a8b80>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10929bbe0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10b1ae4f0>
          └ <fastapi.applications.FastAPI object at 0x10b1a8b80>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10b1b9d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x10b1ae550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10b1ae4f0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10b1b9d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10b1ae580>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x10b1ae550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b1b9dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10b1ae0a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10b1ae580>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b1b9dc0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x10a057dc0>
          └ <fastapi.routing.APIRoute object at 0x10b1be3d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b1b9dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b1db5b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x10b1b95e0>
          └ <fastapi.routing.APIRoute object at 0x10b1be3d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10b1db190>
                     └ <function get_request_handler.<locals>.app at 0x10b1b9550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10a044d30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x10b1db730>, 'request': <starlette.requests.Request object at 0x10b1...
                 │         └ <function avatar_upload at 0x10b18d8b0>
                 └ <fastapi.dependencies.models.Dependant object at 0x10b1be4c0>

> File "./app/api/user_info.py", line 38, in avatar_upload
    avatar_db.save_img(user_id, avatar)
    │         │        │        └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │        └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x10ac45160>
    └ <utils.services.db.mongodb.MongoDB object at 0x10b187f40>

  File "./utils/services/db/mongodb.py", line 146, in save_img
    save_data = base64.b64encode(bson.binary.Binary(img.getvalue())).decode('ascii')
                │      │         │    │      │      └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
                │      │         │    │      └ <class 'bson.binary.Binary'>
                │      │         │    └ <module 'bson.binary' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/binary.py'>
                │      │         └ <module 'bson' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/__init__.py'>
                │      └ <function b64encode at 0x1089b1ee0>
                └ <module 'base64' from '/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/base64.py'>

AttributeError: 'bytes' object has no attribute 'getvalue'
2021-06-08  :10:02 - ERROR - user_info.py - 38 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-29' (18583), thread 'MainThread' (4451227072):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x101953430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x1017e0280>
           └ <SpawnProcess name='SpawnProcess-29' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1017dd8b0>
    └ <SpawnProcess name='SpawnProcess-29' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1019da0a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-29' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-29' parent=15698 started>
    │    └ <function subprocess_started at 0x101978ca0>
    └ <SpawnProcess name='SpawnProcess-29' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1019da040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x10196fe50>
    │    │                  └ <uvicorn.server.Server object at 0x1019da040>
    │    └ <function BaseEventLoop.run_until_complete at 0x101f61700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x101f61670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101f641f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x101eb9550>
    └ <Handle <TaskWakeupMethWrapper object at 0x1043261f0>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x1043261f0>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x1043261f0>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x1043261f0>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1023be700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x1023be790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102357be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x104264b20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102357be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10426a4c0>
          └ <fastapi.applications.FastAPI object at 0x104264b20>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x104276ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x10426a520>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10426a4c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x104276ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10426a550>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x10426a520>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104276d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10426a070>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10426a550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104276d30>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x103113dc0>
          └ <fastapi.routing.APIRoute object at 0x10427a3a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104276d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104299580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x104276550>
          └ <fastapi.routing.APIRoute object at 0x10427a3a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x104299160>
                     └ <function get_request_handler.<locals>.app at 0x1042764c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1030ffd30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x104299700>, 'request': <starlette.requests.Request object at 0x1042...
                 │         └ <function avatar_upload at 0x104245820>
                 └ <fastapi.dependencies.models.Dependant object at 0x10427a490>

> File "./app/api/user_info.py", line 38, in avatar_upload
    avatar_db.save_img(user_id, avatar)
    │         │        │        └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │        └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x103d01160>
    └ <utils.services.db.mongodb.MongoDB object at 0x104242f10>

  File "./utils/services/db/mongodb.py", line 146, in save_img
    save_data = base64.b64encode(bson.binary.Binary(img.getvalue())).decode('ascii')
                │      │         │    │      │      └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
                │      │         │    │      └ <class 'bson.binary.Binary'>
                │      │         │    └ <module 'bson.binary' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/binary.py'>
                │      │         └ <module 'bson' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/__init__.py'>
                │      └ <function b64encode at 0x101a6dee0>
                └ <module 'base64' from '/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/base64.py'>

AttributeError: 'bytes' object has no attribute 'getvalue'
2021-06-08  :11:21 - ERROR - user_info.py - 40 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-31' (18608), thread 'MainThread' (4579653056):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x109e37430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x109cc4280>
           └ <SpawnProcess name='SpawnProcess-31' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x109cc18b0>
    └ <SpawnProcess name='SpawnProcess-31' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x109ebe0a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-31' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-31' parent=15698 started>
    │    └ <function subprocess_started at 0x109e5aca0>
    └ <SpawnProcess name='SpawnProcess-31' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x109ebe040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x109e53e50>
    │    │                  └ <uvicorn.server.Server object at 0x109ebe040>
    │    └ <function BaseEventLoop.run_until_complete at 0x10a444700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10a444670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10a4471f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10a39d550>
    └ <Handle <TaskWakeupMethWrapper object at 0x10c85a1f0>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x10c85a1f0>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x10c85a1f0>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x10c85a1f0>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x10a898700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x10a898790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10a83bbe0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10c746b20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10a83bbe0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10c74d4c0>
          └ <fastapi.applications.FastAPI object at 0x10c746b20>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10c758ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x10c74d520>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10c74d4c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10c758ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10c74d550>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x10c74d520>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10c758d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10c74d070>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10c74d550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10c758d30>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x10b5f7dc0>
          └ <fastapi.routing.APIRoute object at 0x10c75e3a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10c758d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10c77d580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x10c758550>
          └ <fastapi.routing.APIRoute object at 0x10c75e3a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10c77d160>
                     └ <function get_request_handler.<locals>.app at 0x10c7584c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10b5e3d30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x10c77d700>, 'request': <starlette.requests.Request object at 0x10c7...
                 │         └ <function avatar_upload at 0x10c72b820>
                 └ <fastapi.dependencies.models.Dependant object at 0x10c75e490>

> File "./app/api/user_info.py", line 40, in avatar_upload
    avatar_db.save_img(user_id, avatar)
    │         │        │        └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │        └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x10c1e4160>
    └ <utils.services.db.mongodb.MongoDB object at 0x10c725f10>

  File "./utils/services/db/mongodb.py", line 146, in save_img
    save_data = base64.b64encode(bson.binary.Binary(img.getvalue())).decode('ascii')
                │      │         │    │      │      └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
                │      │         │    │      └ <class 'bson.binary.Binary'>
                │      │         │    └ <module 'bson.binary' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/binary.py'>
                │      │         └ <module 'bson' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/__init__.py'>
                │      └ <function b64encode at 0x109f51ee0>
                └ <module 'base64' from '/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/base64.py'>

AttributeError: 'bytes' object has no attribute 'getvalue'
2021-06-08  :11:38 - ERROR - user_info.py - 40 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-32' (18623), thread 'MainThread' (4528965056):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x106d42430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x106bd0280>
           └ <SpawnProcess name='SpawnProcess-32' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x106bc28b0>
    └ <SpawnProcess name='SpawnProcess-32' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x106dca0a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-32' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-32' parent=15698 started>
    │    └ <function subprocess_started at 0x106d66ca0>
    └ <SpawnProcess name='SpawnProcess-32' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x106dca040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x106d65e50>
    │    │                  └ <uvicorn.server.Server object at 0x106dca040>
    │    └ <function BaseEventLoop.run_until_complete at 0x107350700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x107350670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1073531f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1072a9550>
    └ <Handle <TaskWakeupMethWrapper object at 0x109721220>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x109721220>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x109721220>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x109721220>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1077a4700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x1077a4790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107747be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x109652b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107747be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109659580>
          └ <fastapi.applications.FastAPI object at 0x109652b50>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x109663d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x1096595e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109659580>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x109663d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x109659610>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x1096595e0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109663dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1096590a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x109659610>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109663dc0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x108503dc0>
          └ <fastapi.routing.APIRoute object at 0x10966a3d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109663dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1096875b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x1096635e0>
          └ <fastapi.routing.APIRoute object at 0x10966a3d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x109687190>
                     └ <function get_request_handler.<locals>.app at 0x109663550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1084efd30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x109687730>, 'request': <starlette.requests.Request object at 0x1096...
                 │         └ <function avatar_upload at 0x1096378b0>
                 └ <fastapi.dependencies.models.Dependant object at 0x10966a4c0>

> File "./app/api/user_info.py", line 40, in avatar_upload
    avatar_db.save_img(user_id, avatar)
    │         │        │        └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │        └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x1090f0160>
    └ <utils.services.db.mongodb.MongoDB object at 0x109631f40>

  File "./utils/services/db/mongodb.py", line 146, in save_img
    save_data = base64.b64encode(bson.binary.Binary(img.getvalue())).decode('ascii')
                │      │         │    │      │      └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
                │      │         │    │      └ <class 'bson.binary.Binary'>
                │      │         │    └ <module 'bson.binary' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/binary.py'>
                │      │         └ <module 'bson' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/__init__.py'>
                │      └ <function b64encode at 0x106e5dee0>
                └ <module 'base64' from '/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/base64.py'>

AttributeError: 'bytes' object has no attribute 'getvalue'
2021-06-08  :12:02 - ERROR - user_info.py - 40 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-33' (18630), thread 'MainThread' (4750894528):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x10e1c5430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x10e052280>
           └ <SpawnProcess name='SpawnProcess-33' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10e04f8b0>
    └ <SpawnProcess name='SpawnProcess-33' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10e24c0a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-33' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-33' parent=15698 started>
    │    └ <function subprocess_started at 0x10e1e8ca0>
    └ <SpawnProcess name='SpawnProcess-33' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10e24c040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x10e1e7e50>
    │    │                  └ <uvicorn.server.Server object at 0x10e24c040>
    │    └ <function BaseEventLoop.run_until_complete at 0x10e7d2700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10e7d2670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10e7d51f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10e72b550>
    └ <Handle <TaskWakeupMethWrapper object at 0x110b76220>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x110b76220>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x110b76220>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x110b76220>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x10ec26700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x10ec26790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10ebc9be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x110ad4b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10ebc9be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110adb4f0>
          └ <fastapi.applications.FastAPI object at 0x110ad4b50>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x110ae6ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x110adb550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110adb4f0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x110ae6ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x110adb580>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x110adb550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110ae6d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x110adb0a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x110adb580>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110ae6d30>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x10f985dc0>
          └ <fastapi.routing.APIRoute object at 0x110aec3d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110ae6d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110b095b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x110ae6550>
          └ <fastapi.routing.APIRoute object at 0x110aec3d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x110b09190>
                     └ <function get_request_handler.<locals>.app at 0x110ae64c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10f972d30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x110b09730>, 'request': <starlette.requests.Request object at 0x110b...
                 │         └ <function avatar_upload at 0x110ab9820>
                 └ <fastapi.dependencies.models.Dependant object at 0x110aec4c0>

> File "./app/api/user_info.py", line 40, in avatar_upload
    avatar_db.save_img(user_id, com)
    │         │        │        └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │        └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x110572160>
    └ <utils.services.db.mongodb.MongoDB object at 0x110ab4f40>

  File "./utils/services/db/mongodb.py", line 146, in save_img
    save_data = base64.b64encode(bson.binary.Binary(img.getvalue())).decode('ascii')
                │      │         │    │      │      └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
                │      │         │    │      └ <class 'bson.binary.Binary'>
                │      │         │    └ <module 'bson.binary' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/binary.py'>
                │      │         └ <module 'bson' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/bson/__init__.py'>
                │      └ <function b64encode at 0x10e2dfee0>
                └ <module 'base64' from '/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/base64.py'>

AttributeError: 'bytes' object has no attribute 'getvalue'
2021-06-08  :14:19 - ERROR - user_info.py - 38 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-35' (18655), thread 'MainThread' (4602082752):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x10d003430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x10ce90280>
           └ <SpawnProcess name='SpawnProcess-35' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10ce828b0>
    └ <SpawnProcess name='SpawnProcess-35' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10d08a0a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-35' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-35' parent=15698 started>
    │    └ <function subprocess_started at 0x10d028ca0>
    └ <SpawnProcess name='SpawnProcess-35' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10d08a040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x10d01fe50>
    │    │                  └ <uvicorn.server.Server object at 0x10d08a040>
    │    └ <function BaseEventLoop.run_until_complete at 0x10d610700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10d610670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10d6131f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10d569550>
    └ <Handle <TaskWakeupMethWrapper object at 0x10f9d6220>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x10f9d6220>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x10f9d6220>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x10f9d6220>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x10da6e700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x10da6e790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10da07be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10f915b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10da07be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10f91b4f0>
          └ <fastapi.applications.FastAPI object at 0x10f915b50>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10f926ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x10f91b550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10f91b4f0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10f926ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10f91b580>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x10f91b550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10f926d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10f91b0a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10f91b580>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10f926d30>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x10e7c3dc0>
          └ <fastapi.routing.APIRoute object at 0x10f92a3d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10f926d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9475b0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x10f926550>
          └ <fastapi.routing.APIRoute object at 0x10f92a3d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10f947190>
                     └ <function get_request_handler.<locals>.app at 0x10f9264c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10e7afd30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x10f947730>, 'request': <starlette.requests.Request object at 0x10f9...
                 │         └ <function avatar_upload at 0x10f8f8820>
                 └ <fastapi.dependencies.models.Dependant object at 0x10f92a4c0>

> File "./app/api/user_info.py", line 38, in avatar_upload
    avatar_db.save_img(user_id, BytesIO(avatar))
    │         │        │        │       └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │        │        └ <class '_io.BytesIO'>
    │         │        └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x10f3b1160>
    └ <utils.services.db.mongodb.MongoDB object at 0x10f8f3f40>

  File "./utils/services/db/mongodb.py", line 148, in save_img
    self.collection.update_one({'user_id': user_id}, {'img': save_data})
    │    │          │                      │                 └ 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuMZRIMpWoEKWS...
    │    │          │                      └ 3470266988381601792
    │    │          └ <function Collection.update_one at 0x10ef1fe50>
    │    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'av...
    └ <utils.services.db.mongodb.MongoDB object at 0x10f8f3f40>

  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 1014, in update_one
    common.validate_ok_for_update(update)
    │      │                      └ {'img': 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuMZRI...
    │      └ <function validate_ok_for_update at 0x10eea4790>
    └ <module 'pymongo.common' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py'>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py", line 557, in validate_ok_for_update
    raise ValueError('update only works with $ operators')

ValueError: update only works with $ operators
2021-06-08  :15:07 - ERROR - user_info.py - 38 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-35' (18655), thread 'MainThread' (4602082752):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x10d003430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x10ce90280>
           └ <SpawnProcess name='SpawnProcess-35' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10ce828b0>
    └ <SpawnProcess name='SpawnProcess-35' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10d08a0a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-35' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-35' parent=15698 started>
    │    └ <function subprocess_started at 0x10d028ca0>
    └ <SpawnProcess name='SpawnProcess-35' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10d08a040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x10d01fe50>
    │    │                  └ <uvicorn.server.Server object at 0x10d08a040>
    │    └ <function BaseEventLoop.run_until_complete at 0x10d610700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10d610670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10d6131f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10d569550>
    └ <Handle <TaskWakeupMethWrapper object at 0x10f947a00>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x10f947a00>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x10f947a00>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x10f947a00>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x10da6e700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x10da6e790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10da07be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10f915b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10da07be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10f91b4f0>
          └ <fastapi.applications.FastAPI object at 0x10f915b50>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10f9fa550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x10f91b550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10f91b4f0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10f9fa550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10f91b580>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x10f91b550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10f9fa0d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10f91b0a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10f91b580>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10f9fa0d0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x10e7c3dc0>
          └ <fastapi.routing.APIRoute object at 0x10f92a3d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10f9fa0d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10f9d6e20>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x10f926550>
          └ <fastapi.routing.APIRoute object at 0x10f92a3d0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10f9d6f10>
                     └ <function get_request_handler.<locals>.app at 0x10f9264c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10e7afd30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x10f9d6070>, 'request': <starlette.requests.Request object at 0x10f9...
                 │         └ <function avatar_upload at 0x10f8f8820>
                 └ <fastapi.dependencies.models.Dependant object at 0x10f92a4c0>

> File "./app/api/user_info.py", line 38, in avatar_upload
    avatar_db.save_img(user_id, BytesIO(avatar))
    │         │        │        │       └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │        │        └ <class '_io.BytesIO'>
    │         │        └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x10f3b1160>
    └ <utils.services.db.mongodb.MongoDB object at 0x10f8f3f40>

  File "./utils/services/db/mongodb.py", line 148, in save_img
    self.collection.update_one({'user_id': user_id}, {'img': save_data})
    │    │          │                      │                 └ 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuMZRIMpWoEKWS...
    │    │          │                      └ 3470266988381601792
    │    │          └ <function Collection.update_one at 0x10ef1fe50>
    │    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'av...
    └ <utils.services.db.mongodb.MongoDB object at 0x10f8f3f40>

  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 1014, in update_one
    common.validate_ok_for_update(update)
    │      │                      └ {'img': 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuMZRI...
    │      └ <function validate_ok_for_update at 0x10eea4790>
    └ <module 'pymongo.common' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py'>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py", line 557, in validate_ok_for_update
    raise ValueError('update only works with $ operators')

ValueError: update only works with $ operators
2021-06-08  :22:38 - ERROR - user_info.py - 38 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-40' (18764), thread 'MainThread' (4547593664):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x1058d2430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x10575f280>
           └ <SpawnProcess name='SpawnProcess-40' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10575c8b0>
    └ <SpawnProcess name='SpawnProcess-40' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1059590a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-40' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-40' parent=15698 started>
    │    └ <function subprocess_started at 0x1058f5ca0>
    └ <SpawnProcess name='SpawnProcess-40' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x105959040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x1058eee50>
    │    │                  └ <uvicorn.server.Server object at 0x105959040>
    │    └ <function BaseEventLoop.run_until_complete at 0x105edf700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105edf670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105ee21f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105e38550>
    └ <Handle <TaskWakeupMethWrapper object at 0x1082a51c0>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x1082a51c0>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x1082a51c0>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x1082a51c0>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x10633d700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x10633d790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1062d6be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1081e3af0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1062d6be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1081ea490>
          └ <fastapi.applications.FastAPI object at 0x1081e3af0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1081f5ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x1081ea4f0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1081ea490>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1081f5ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1081ea520>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x1081ea4f0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1081f5d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1081ea040>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1081ea520>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1081f5d30>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x107092dc0>
          └ <fastapi.routing.APIRoute object at 0x1081f8370>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1081f5d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108218550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x1081f5550>
          └ <fastapi.routing.APIRoute object at 0x1081f8370>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x108218130>
                     └ <function get_request_handler.<locals>.app at 0x1081f54c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10707fd30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x1082186d0>, 'request': <starlette.requests.Request object at 0x1082...
                 │         └ <function avatar_upload at 0x1081c7820>
                 └ <fastapi.dependencies.models.Dependant object at 0x1081f8460>

> File "./app/api/user_info.py", line 38, in avatar_upload
    avatar_db.save_img(user_id=user_id, img=BytesIO(avatar), img_name='avatar')
    │         │                │            │       └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │                │            └ <class '_io.BytesIO'>
    │         │                └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x107c7f160>
    └ <utils.services.db.mongodb.MongoDB object at 0x1081c3ee0>

  File "./utils/services/db/mongodb.py", line 148, in save_img
    self.collection.update_one({'user_id': user_id}, {f'{img_name}': save_data})
    │    │          │                      │                         └ 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuMZRIMpWoEKWS...
    │    │          │                      └ 3470266988381601792
    │    │          └ <function Collection.update_one at 0x1077eee50>
    │    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'av...
    └ <utils.services.db.mongodb.MongoDB object at 0x1081c3ee0>

  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 1014, in update_one
    common.validate_ok_for_update(update)
    │      │                      └ {'avatar': 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuM...
    │      └ <function validate_ok_for_update at 0x107773790>
    └ <module 'pymongo.common' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py'>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py", line 557, in validate_ok_for_update
    raise ValueError('update only works with $ operators')

ValueError: update only works with $ operators
2021-06-08  :23:18 - ERROR - user_info.py - 38 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-40' (18764), thread 'MainThread' (4547593664):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x1058d2430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x10575f280>
           └ <SpawnProcess name='SpawnProcess-40' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10575c8b0>
    └ <SpawnProcess name='SpawnProcess-40' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1059590a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-40' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-40' parent=15698 started>
    │    └ <function subprocess_started at 0x1058f5ca0>
    └ <SpawnProcess name='SpawnProcess-40' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x105959040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x1058eee50>
    │    │                  └ <uvicorn.server.Server object at 0x105959040>
    │    └ <function BaseEventLoop.run_until_complete at 0x105edf700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105edf670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105ee21f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105e38550>
    └ <Handle <TaskWakeupMethWrapper object at 0x108218dc0>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x108218dc0>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x108218dc0>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x108218dc0>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x10633d700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x10633d790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1062d6be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1081e3af0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1062d6be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1081ea490>
          └ <fastapi.applications.FastAPI object at 0x1081e3af0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1082c9550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x1081ea4f0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1081ea490>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1082c9550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1081ea520>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x1081ea4f0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1082c90d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1081ea040>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1081ea520>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1082c90d0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x107092dc0>
          └ <fastapi.routing.APIRoute object at 0x1081f8370>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1082c90d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1082a5e20>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x1081f5550>
          └ <fastapi.routing.APIRoute object at 0x1081f8370>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1082a5790>
                     └ <function get_request_handler.<locals>.app at 0x1081f54c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10707fd30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x1082a57f0>, 'request': <starlette.requests.Request object at 0x1082...
                 │         └ <function avatar_upload at 0x1081c7820>
                 └ <fastapi.dependencies.models.Dependant object at 0x1081f8460>

> File "./app/api/user_info.py", line 38, in avatar_upload
    avatar_db.save_img(user_id=user_id, img=BytesIO(avatar), img_name='avatar')
    │         │                │            │       └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │                │            └ <class '_io.BytesIO'>
    │         │                └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x107c7f160>
    └ <utils.services.db.mongodb.MongoDB object at 0x1081c3ee0>

  File "./utils/services/db/mongodb.py", line 148, in save_img
    self.collection.update_one({'user_id': user_id}, {f'{img_name}': save_data})
    │    │          │                      │                         └ 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuMZRIMpWoEKWS...
    │    │          │                      └ 3470266988381601792
    │    │          └ <function Collection.update_one at 0x1077eee50>
    │    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'av...
    └ <utils.services.db.mongodb.MongoDB object at 0x1081c3ee0>

  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 1014, in update_one
    common.validate_ok_for_update(update)
    │      │                      └ {'avatar': 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuM...
    │      └ <function validate_ok_for_update at 0x107773790>
    └ <module 'pymongo.common' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py'>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py", line 557, in validate_ok_for_update
    raise ValueError('update only works with $ operators')

ValueError: update only works with $ operators
2021-06-08  :25:45 - ERROR - user_info.py - 38 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-42' (18792), thread 'MainThread' (4440098240):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x106002430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x105e8f280>
           └ <SpawnProcess name='SpawnProcess-42' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x105e8c8b0>
    └ <SpawnProcess name='SpawnProcess-42' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1060890a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-42' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-42' parent=15698 started>
    │    └ <function subprocess_started at 0x106027ca0>
    └ <SpawnProcess name='SpawnProcess-42' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x106089040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x106018e50>
    │    │                  └ <uvicorn.server.Server object at 0x106089040>
    │    └ <function BaseEventLoop.run_until_complete at 0x106610700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x106610670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1066131f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x106568550>
    └ <Handle <TaskWakeupMethWrapper object at 0x10895d310>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x10895d310>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x10895d310>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x10895d310>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x106a6d700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x106a6d790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106a06be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108913b20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106a06be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10891a4c0>
          └ <fastapi.applications.FastAPI object at 0x108913b20>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x108925ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x10891a520>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10891a4c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x108925ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10891a550>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x10891a520>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108925d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10891a070>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10891a550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108925d30>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x1077c2dc0>
          └ <fastapi.routing.APIRoute object at 0x1089283a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108925d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108948580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x108925550>
          └ <fastapi.routing.APIRoute object at 0x1089283a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x108948160>
                     └ <function get_request_handler.<locals>.app at 0x1089254c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1077aed30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x108948700>, 'request': <starlette.requests.Request object at 0x1089...
                 │         └ <function avatar_upload at 0x1088f7820>
                 └ <fastapi.dependencies.models.Dependant object at 0x108928490>

> File "./app/api/user_info.py", line 38, in avatar_upload
    avatar_db.save_img(user_id=user_id, img=BytesIO(avatar), img_name='avatar')
    │         │                │            │       └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │                │            └ <class '_io.BytesIO'>
    │         │                └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x1083af160>
    └ <utils.services.db.mongodb.MongoDB object at 0x1088f3f10>

  File "./utils/services/db/mongodb.py", line 148, in save_img
    self.collection.update_one({'user_id': user_id}, {f'{img_name}': save_data})
    │    │          │                      │                         └ 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuMZRIMpWoEKWS...
    │    │          │                      └ 3470266988381601792
    │    │          └ <function Collection.update_one at 0x107f1ee50>
    │    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'av...
    └ <utils.services.db.mongodb.MongoDB object at 0x1088f3f10>

  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 1014, in update_one
    common.validate_ok_for_update(update)
    │      │                      └ {'avatar': 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuM...
    │      └ <function validate_ok_for_update at 0x107ea3790>
    └ <module 'pymongo.common' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py'>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py", line 557, in validate_ok_for_update
    raise ValueError('update only works with $ operators')

ValueError: update only works with $ operators
2021-06-08  :26:41 - ERROR - user_info.py - 38 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-43' (18809), thread 'MainThread' (4493891008):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x10b217430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x10b0a4280>
           └ <SpawnProcess name='SpawnProcess-43' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10b0a18b0>
    └ <SpawnProcess name='SpawnProcess-43' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10b29e0a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-43' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-43' parent=15698 started>
    │    └ <function subprocess_started at 0x10b23aca0>
    └ <SpawnProcess name='SpawnProcess-43' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10b29e040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x10b233e50>
    │    │                  └ <uvicorn.server.Server object at 0x10b29e040>
    │    └ <function BaseEventLoop.run_until_complete at 0x10b825700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10b825670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10b8281f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10b77d550>
    └ <Handle <TaskWakeupMethWrapper object at 0x10dd071f0>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x10dd071f0>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x10dd071f0>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x10dd071f0>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x10bc82700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x10bc82790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10bc1bbe0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10dbf5b20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10bc1bbe0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10dbfc4c0>
          └ <fastapi.applications.FastAPI object at 0x10dbf5b20>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10dc06d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x10dbfc520>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10dbfc4c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10dc06d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10dbfc550>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x10dbfc520>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10dc06dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10dbfc070>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10dbfc550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10dc06dc0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x10caa8dc0>
          └ <fastapi.routing.APIRoute object at 0x10dc0a3a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10dc06dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10dc2a580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x10dc065e0>
          └ <fastapi.routing.APIRoute object at 0x10dc0a3a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10dc2a160>
                     └ <function get_request_handler.<locals>.app at 0x10dc06550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10ca95d30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x10dc2a700>, 'request': <starlette.requests.Request object at 0x10dc...
                 │         └ <function avatar_upload at 0x10dbd78b0>
                 └ <fastapi.dependencies.models.Dependant object at 0x10dc0a490>

> File "./app/api/user_info.py", line 38, in avatar_upload
    avatar_db.save_img(user_id=user_id, img=BytesIO(avatar), img_name='avatar')
    │         │                │            │       └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │                │            └ <class '_io.BytesIO'>
    │         │                └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x10d6911f0>
    └ <utils.services.db.mongodb.MongoDB object at 0x10dbd5f10>

  File "./utils/services/db/mongodb.py", line 148, in save_img
    self.collection.update_one({'user_id': user_id}, {f'{img_name}': save_data})
    │    │          │                      │                         └ 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuMZRIMpWoEKWS...
    │    │          │                      └ 3470266988381601792
    │    │          └ <function Collection.update_one at 0x10d201ee0>
    │    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'av...
    └ <utils.services.db.mongodb.MongoDB object at 0x10dbd5f10>

  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 1014, in update_one
    common.validate_ok_for_update(update)
    │      │                      └ {'avatar': 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuM...
    │      └ <function validate_ok_for_update at 0x10d185820>
    └ <module 'pymongo.common' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py'>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py", line 557, in validate_ok_for_update
    raise ValueError('update only works with $ operators')

ValueError: update only works with $ operators
2021-06-08  :27:16 - ERROR - user_info.py - 38 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-44' (18818), thread 'MainThread' (4635686336):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x108202430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x10808f280>
           └ <SpawnProcess name='SpawnProcess-44' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10808c8b0>
    └ <SpawnProcess name='SpawnProcess-44' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1082890a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-44' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-44' parent=15698 started>
    │    └ <function subprocess_started at 0x108227ca0>
    └ <SpawnProcess name='SpawnProcess-44' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108289040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x108218e50>
    │    │                  └ <uvicorn.server.Server object at 0x108289040>
    │    └ <function BaseEventLoop.run_until_complete at 0x108810700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x108810670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1088131f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x108768550>
    └ <Handle <TaskWakeupMethWrapper object at 0x10abd5310>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x10abd5310>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x10abd5310>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x10abd5310>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x108c66700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x108c66790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108c06be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10ab14b20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108c06be0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10ab1a4c0>
          └ <fastapi.applications.FastAPI object at 0x10ab14b20>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10ab25ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x10ab1a520>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10ab1a4c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10ab25ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10ab1a550>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x10ab1a520>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10ab25d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10ab1a070>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10ab1a550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10ab25d30>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x1099c2dc0>
          └ <fastapi.routing.APIRoute object at 0x10ab283a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10ab25d30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ab48580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x10ab25550>
          └ <fastapi.routing.APIRoute object at 0x10ab283a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10ab48190>
                     └ <function get_request_handler.<locals>.app at 0x10ab254c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1099afd30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x10ab48070>, 'request': <starlette.requests.Request object at 0x10ab...
                 │         └ <function avatar_upload at 0x10aaf7820>
                 └ <fastapi.dependencies.models.Dependant object at 0x10ab28490>

> File "./app/api/user_info.py", line 38, in avatar_upload
    avatar_db.save_img(user_id=user_id, img=BytesIO(avatar), img_name='avatar')
    │         │                │            │       └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │                │            └ <class '_io.BytesIO'>
    │         │                └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x10a5af160>
    └ <utils.services.db.mongodb.MongoDB object at 0x10aaf3f10>

  File "./utils/services/db/mongodb.py", line 148, in save_img
    self.collection.update_one({'user_id': user_id}, {f'{img_name}': save_data})
    │    │          │                      │                         └ 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuMZRIMpWoEKWS...
    │    │          │                      └ 3470266988381601792
    │    │          └ <function Collection.update_one at 0x10a11ee50>
    │    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'av...
    └ <utils.services.db.mongodb.MongoDB object at 0x10aaf3f10>

  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 1014, in update_one
    common.validate_ok_for_update(update)
    │      │                      └ {'avatar': 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuM...
    │      └ <function validate_ok_for_update at 0x10a0a3790>
    └ <module 'pymongo.common' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py'>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py", line 557, in validate_ok_for_update
    raise ValueError('update only works with $ operators')

ValueError: update only works with $ operators
2021-06-08  :27:39 - ERROR - user_info.py - 38 - An error has been caught in function 'avatar_upload', process 'SpawnProcess-45' (18821), thread 'MainThread' (4586755520):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 5
               │     └ 8
               └ <function _main at 0x101e98430>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 5
           │    └ <function BaseProcess._bootstrap at 0x101d25280>
           └ <SpawnProcess name='SpawnProcess-45' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x101d228b0>
    └ <SpawnProcess name='SpawnProcess-45' parent=15698 started>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x101f1f0a0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-45' parent=15698 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-45' parent=15698 started>
    │    └ <function subprocess_started at 0x101ebdca0>
    └ <SpawnProcess name='SpawnProcess-45' parent=15698 started>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x101f1f040>>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=4, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x101eaee50>
    │    │                  └ <uvicorn.server.Server object at 0x101f1f040>
    │    └ <function BaseEventLoop.run_until_complete at 0x1024a6700>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1024a6670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1024a91f0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1023fe550>
    └ <Handle <TaskWakeupMethWrapper object at 0x1047f41f0>(<Future finis...6988381601792>)>
  File "/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskWakeupMethWrapper object at 0x1047f41f0>(<Future finis...6988381601792>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskWakeupMethWrapper object at 0x1047f41f0>(<Future finis...6988381601792>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskWakeupMethWrapper object at 0x1047f41f0>(<Future finis...6988381601792>)>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1028fb700>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x1028fb790>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10289cbe0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1047a9b20>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10289cbe0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1047b04c0>
          └ <fastapi.applications.FastAPI object at 0x1047a9b20>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1047bad30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x1047b0520>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1047b04c0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1047bad30>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1047b0550>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x1047b0520>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1047badc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1047b0070>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1047b0550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1047badc0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x103658dc0>
          └ <fastapi.routing.APIRoute object at 0x1047be3a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1047badc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1047de580>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x1047ba5e0>
          └ <fastapi.routing.APIRoute object at 0x1047be3a0>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1047de160>
                     └ <function get_request_handler.<locals>.app at 0x1047ba550>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x103645d30>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x1047de700>, 'request': <starlette.requests.Request object at 0x1047...
                 │         └ <function avatar_upload at 0x10478b8b0>
                 └ <fastapi.dependencies.models.Dependant object at 0x1047be490>

> File "./app/api/user_info.py", line 38, in avatar_upload
    avatar_db.save_img(user_id=user_id, img=BytesIO(avatar), img_name='avatar')
    │         │                │            │       └ b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x05\x9f\x00\x00\x03\x15\x08\x06\x00\x00\x00\x18\x8f\x8a\x81\x00\x00\x18OiCCPICC...
    │         │                │            └ <class '_io.BytesIO'>
    │         │                └ 3470266988381601792
    │         └ <function MongoDB.save_img at 0x1042451f0>
    └ <utils.services.db.mongodb.MongoDB object at 0x104789f10>

  File "./utils/services/db/mongodb.py", line 148, in save_img
    self.collection.update_one({'user_id': user_id}, {f'{img_name}': save_data})
    │    │          │                      │                         └ 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuMZRIMpWoEKWS...
    │    │          │                      └ 3470266988381601792
    │    │          └ <function Collection.update_one at 0x103db5ee0>
    │    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'av...
    └ <utils.services.db.mongodb.MongoDB object at 0x104789f10>

  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 1014, in update_one
    common.validate_ok_for_update(update)
    │      │                      └ {'avatar': 'iVBORw0KGgoAAAANSUhEUgAABZ8AAAMVCAYAAAAYj4qBAAAYT2lDQ1BJQ0MgUHJvZmlsZQAAWIWVWQk0Vd3b3+fO95rvNc/zTOZ5nud5JuGarimuM...
    │      └ <function validate_ok_for_update at 0x103d39820>
    └ <module 'pymongo.common' from '/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py'>
  File "/Users/antx/Code/prm/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/common.py", line 557, in validate_ok_for_update
    raise ValueError('update only works with $ operators')

ValueError: update only works with $ operators
2021-06-08  :42:28 - ERROR - user_handler.py - 54 - An error has been caught in function 'generate_qrcode', process 'SpawnProcess-21' (129692), thread 'MainThread' (139855075563328):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f328b825c10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f328b9eb310>
           └ <SpawnProcess name='SpawnProcess-21' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f328b9e7940>
    └ <SpawnProcess name='SpawnProcess-21' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f328b7bba30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-21' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-21' parent=18601 started>
    │    └ <function subprocess_started at 0x7f328aeeeb80>
    └ <SpawnProcess name='SpawnProcess-21' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f328b7bbb20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7f328aeee160>
    │    │                  └ <uvicorn.server.Server object at 0x7f328b7bbb20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7f328b236670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f328b2365e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f328b239160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f328b2a8ee0>
    └ <Handle <TaskStepMethWrapper object at 0x7f3282071910>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7f3282071910>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7f3282071910>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7f3282071910>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f328ae103a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f328ae10430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f328ae38550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f32820c09a0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f328ae38550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f32820c5340>
          └ <fastapi.applications.FastAPI object at 0x7f32820c09a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f32820583a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f32820c53a0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f32820c5340>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f32820583a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f32820c53d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f32820c53a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3282058430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f32820c0eb0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f32820c53d0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3282058430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7f328a2b6310>
          └ <fastapi.routing.APIRoute object at 0x7f32820c5370>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3282058430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f32820718e0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f32820c7790>
          └ <fastapi.routing.APIRoute object at 0x7f32820c5370>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f32820715b0>
                     └ <function get_request_handler.<locals>.app at 0x7f32820c71f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f328a3253a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=15738368019, email_code='1234', phone_code=None, invite_code='ASDF123'), 'r...
                 │         └ <function login at 0x7f32820f3a60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f32820c5250>

  File "./app/api/user.py", line 68, in login
    generate_qrcode(user_id, promo_code(user_id))
    │               │        │          └ 3471173057547075584
    │               │        └ <function promo_code at 0x7f32821b5ee0>
    │               └ 3471173057547075584
    └ <function generate_qrcode at 0x7f32821b5f70>

> File "./app/handler/user_handler.py", line 54, in generate_qrcode
    mongodb.save_img(user_id=user_id, img=img_png, img_name=promo_code, qr_code=True)
    │       │                │            │                 └ '30I5o4V0'
    │       │                │            └ <_io.BytesIO object at 0x7f328076ecc0>
    │       │                └ 3471173057547075584
    │       └ <function MongoDB.save_img at 0x7f328800e790>
    └ <utils.services.db.mongodb.MongoDB object at 0x7f3282071af0>

  File "./utils/services/db/mongodb.py", line 150, in save_img
    self.collection.update_one({'user_id': user_id}, {"$set":{f'promo_code': img_name}, 'promo_qrcode': save_data}, upsert=True)
    │    │          │                      │                                 │                          └ 'iVBORw0KGgoAAAANSUhEUgAAAdYAAAHWAQAAAADiYZX3AAADcUlEQVR4nO2dXW7bMBCEZysBeaRu0KMwN8iRihypN5COkgMYoB8NUJg+8NdOYdmJm8DuzFMs+QNt...
    │    │          │                      │                                 └ '30I5o4V0'
    │    │          │                      └ 3471173057547075584
    │    │          └ <function Collection.update_one at 0x7f3289456f70>
    │    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'pr...
    └ <utils.services.db.mongodb.MongoDB object at 0x7f3282071af0>

  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 1019, in update_one
    self._update_retryable(
    │    └ <function Collection._update_retryable at 0x7f3289456e50>
    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'pr...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 868, in _update_retryable
    return self.__database.client._retryable_write(
           └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'pr...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/mongo_client.py", line 1498, in _retryable_write
    return self._retry_with_session(retryable, func, s, None)
           │    │                   │          │     └ <pymongo.client_session.ClientSession object at 0x7f328077b790>
           │    │                   │          └ <function Collection._update_retryable.<locals>._update at 0x7f32807cfa60>
           │    │                   └ True
           │    └ <function MongoClient._retry_with_session at 0x7f32893f28b0>
           └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False)
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/mongo_client.py", line 1384, in _retry_with_session
    return self._retry_internal(retryable, func, session, bulk)
           │    │               │          │     │        └ None
           │    │               │          │     └ <pymongo.client_session.ClientSession object at 0x7f328077b790>
           │    │               │          └ <function Collection._update_retryable.<locals>._update at 0x7f32807cfa60>
           │    │               └ True
           │    └ <function MongoClient._retry_internal at 0x7f32893f2940>
           └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False)
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/mongo_client.py", line 1416, in _retry_internal
    return func(session, sock_info, retryable)
           │    │        │          └ False
           │    │        └ SocketInfo(<socket.socket fd=28, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 5539...
           │    └ <pymongo.client_session.ClientSession object at 0x7f328077b790>
           └ <function Collection._update_retryable.<locals>._update at 0x7f32807cfa60>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 860, in _update
    return self._update(
           │    └ <function Collection._update at 0x7f3289456dc0>
           └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'pr...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 837, in _update
    _check_write_command_response(result)
    │                             └ {'n': 0, 'nModified': 0, 'writeErrors': [{'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid ...
    └ <function _check_write_command_response at 0x7f3289530700>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/helpers.py", line 226, in _check_write_command_response
    _raise_last_write_error(write_errors)
    │                       └ [{'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update...
    └ <function _raise_last_write_error at 0x7f32895305e0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/helpers.py", line 208, in _raise_last_write_error
    raise WriteError(error.get("errmsg"), error.get("code"), error)
          │          │     │              │     │            └ {'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update ...
          │          │     │              │     └ <method 'get' of 'dict' objects>
          │          │     │              └ {'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update ...
          │          │     └ <method 'get' of 'dict' objects>
          │          └ {'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update ...
          └ <class 'pymongo.errors.WriteError'>

pymongo.errors.WriteError: Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update specified as an array, full error: {'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update specified as an array'}
2021-06-08  :43:41 - ERROR - user_handler.py - 54 - An error has been caught in function 'generate_qrcode', process 'SpawnProcess-22' (130620), thread 'MainThread' (140025276438336):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f5a2c459c10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f5a2c61f310>
           └ <SpawnProcess name='SpawnProcess-22' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f5a2c61b940>
    └ <SpawnProcess name='SpawnProcess-22' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f5a2c3eea30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-22' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-22' parent=18601 started>
    │    └ <function subprocess_started at 0x7f5a2bb22b80>
    └ <SpawnProcess name='SpawnProcess-22' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f5a2c3eeb20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7f5a2bb22160>
    │    │                  └ <uvicorn.server.Server object at 0x7f5a2c3eeb20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7f5a2be6a670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f5a2be6a5e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f5a2be6d160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f5a2bedcee0>
    └ <Handle <TaskStepMethWrapper object at 0x7f5a22ca4850>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7f5a22ca4850>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7f5a22ca4850>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7f5a22ca4850>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f5a2ba443a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f5a2ba44430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5a2ba6c550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f5a22cf29d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5a2ba6c550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5a22cf8370>
          └ <fastapi.applications.FastAPI object at 0x7f5a22cf29d0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5a22c8b3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f5a22cf83d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5a22cf8370>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5a22c8b3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5a22cf8400>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f5a22cf83d0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5a22c8b430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f5a22cf2ee0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5a22cf8400>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5a22c8b430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7f5a2aee9310>
          └ <fastapi.routing.APIRoute object at 0x7f5a22cf83a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5a22c8b430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f5a22ca4820>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f5a22cfa790>
          └ <fastapi.routing.APIRoute object at 0x7f5a22cf83a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5a22ca44f0>
                     └ <function get_request_handler.<locals>.app at 0x7f5a22cfa1f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f5a2af593a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=15738368019, email_code='1234', phone_code=None, invite_code='ASDF123'), 'r...
                 │         └ <function login at 0x7f5a22d25a60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f5a22cf8280>

  File "./app/api/user.py", line 68, in login
    generate_qrcode(user_id, promo_code(user_id))
    │               │        │          └ 3471173362091294720
    │               │        └ <function promo_code at 0x7f5a22de6ee0>
    │               └ 3471173362091294720
    └ <function generate_qrcode at 0x7f5a22de6f70>

> File "./app/handler/user_handler.py", line 54, in generate_qrcode
    mongodb.save_img(user_id=user_id, img=img_png, img_name=promo_code, qr_code=True)
    │       │                │            │                 └ '30I5swxg'
    │       │                │            └ <_io.BytesIO object at 0x7f5a2139ddb0>
    │       │                └ 3471173362091294720
    │       └ <function MongoDB.save_img at 0x7f5a28a3b790>
    └ <utils.services.db.mongodb.MongoDB object at 0x7f5a22ca4a30>

  File "./utils/services/db/mongodb.py", line 150, in save_img
    self.collection.update_one({'user_id': user_id}, {"$set":{f'promo_code': img_name}, 'promo_qrcode': save_data}, upsert=True)
    │    │          │                      │                                 │                          └ 'iVBORw0KGgoAAAANSUhEUgAAAdYAAAHWAQAAAADiYZX3AAADcElEQVR4nO2dUW4iMRBEq9cj5XOQciDnBnuk1d5sOAoHiOT5RBpU+2G3bSBh2GxEIFv1EQH204BU...
    │    │          │                      │                                 └ '30I5swxg'
    │    │          │                      └ 3471173362091294720
    │    │          └ <function Collection.update_one at 0x7f5a2a108f70>
    │    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'pr...
    └ <utils.services.db.mongodb.MongoDB object at 0x7f5a22ca4a30>

  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 1019, in update_one
    self._update_retryable(
    │    └ <function Collection._update_retryable at 0x7f5a2a108e50>
    └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'pr...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 868, in _update_retryable
    return self.__database.client._retryable_write(
           └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'pr...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/mongo_client.py", line 1498, in _retryable_write
    return self._retry_with_session(retryable, func, s, None)
           │    │                   │          │     └ <pymongo.client_session.ClientSession object at 0x7f5a213ac7c0>
           │    │                   │          └ <function Collection._update_retryable.<locals>._update at 0x7f5a21403a60>
           │    │                   └ True
           │    └ <function MongoClient._retry_with_session at 0x7f5a2a0258b0>
           └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False)
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/mongo_client.py", line 1384, in _retry_with_session
    return self._retry_internal(retryable, func, session, bulk)
           │    │               │          │     │        └ None
           │    │               │          │     └ <pymongo.client_session.ClientSession object at 0x7f5a213ac7c0>
           │    │               │          └ <function Collection._update_retryable.<locals>._update at 0x7f5a21403a60>
           │    │               └ True
           │    └ <function MongoClient._retry_internal at 0x7f5a2a025940>
           └ MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False)
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/mongo_client.py", line 1416, in _retry_internal
    return func(session, sock_info, retryable)
           │    │        │          └ False
           │    │        └ SocketInfo(<socket.socket fd=29, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 5580...
           │    └ <pymongo.client_session.ClientSession object at 0x7f5a213ac7c0>
           └ <function Collection._update_retryable.<locals>._update at 0x7f5a21403a60>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 860, in _update
    return self._update(
           │    └ <function Collection._update at 0x7f5a2a108dc0>
           └ Collection(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False), 'bc-app'), 'pr...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/collection.py", line 837, in _update
    _check_write_command_response(result)
    │                             └ {'n': 0, 'nModified': 0, 'writeErrors': [{'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid ...
    └ <function _check_write_command_response at 0x7f5a2a163700>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/helpers.py", line 226, in _check_write_command_response
    _raise_last_write_error(write_errors)
    │                       └ [{'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update...
    └ <function _raise_last_write_error at 0x7f5a2a1635e0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/pymongo/helpers.py", line 208, in _raise_last_write_error
    raise WriteError(error.get("errmsg"), error.get("code"), error)
          │          │     │              │     │            └ {'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update ...
          │          │     │              │     └ <method 'get' of 'dict' objects>
          │          │     │              └ {'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update ...
          │          │     └ <method 'get' of 'dict' objects>
          │          └ {'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update ...
          └ <class 'pymongo.errors.WriteError'>

pymongo.errors.WriteError: Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update specified as an array, full error: {'index': 0, 'code': 9, 'errmsg': 'Unknown modifier: promo_qrcode. Expected a valid update modifier or pipeline-style update specified as an array'}
2021-06-08  :44:55 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-41' (164686), thread 'MainThread' (139817021249344):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f29af4b9c10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f29af67f310>
           └ <SpawnProcess name='SpawnProcess-41' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f29af67b940>
    └ <SpawnProcess name='SpawnProcess-41' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f29af44ea30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-41' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-41' parent=18601 started>
    │    └ <function subprocess_started at 0x7f29aeb82b80>
    └ <SpawnProcess name='SpawnProcess-41' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f29af44eb20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7f29aeb82160>
    │    │                  └ <uvicorn.server.Server object at 0x7f29af44eb20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7f29aeeca670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f29aeeca5e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f29aeecd160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f29aef3cee0>
    └ <Handle <TaskStepMethWrapper object at 0x7f29a5cf2fd0>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7f29a5cf2fd0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7f29a5cf2fd0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7f29a5cf2fd0>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f29aeaa43a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f29aeaa4430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f29aeacc550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f29a5d4a1c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f29aeacc550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f29a5d4ab20>
          └ <fastapi.applications.FastAPI object at 0x7f29a5d4a1c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f29a5ce43a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f29a5d4ab80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f29a5d4ab20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f29a5ce43a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f29a5d4abb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f29a5d4ab80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f29a5ce4430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f29a5d4a6d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f29a5d4abb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f29a5ce4430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7f29adf49310>
          └ <fastapi.routing.APIRoute object at 0x7f29a5d4ab50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f29a5ce4430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a5cf2fa0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f29a5d50790>
          └ <fastapi.routing.APIRoute object at 0x7f29a5d4ab50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f29a5cf2ca0>
                     └ <function get_request_handler.<locals>.app at 0x7f29a5d501f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f29adfb93a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=15738361119, email_code='1234', phone_code=None, invite_code='30I7ork0'), '...
                 │         └ <function login at 0x7f29a5d7da60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f29a5d4aa30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ '30I7ork0'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=15738361119, email_code='1234', phone_code=None, invite_code='30I7ork0')
    │         │        │          └ 3471188774388498432
    │         │        └ <function promo_code at 0x7f29a5e3df70>
    │         └ 3471188774388498432
    └ <function dnetworks at 0x7f29a5e3f700>

  File "./app/handler/user_handler.py", line 82, in dnetworks
    dnk_db.update_one({'own_code': invite_code}, {'af1_code': dnk_db.find_one({'own_code': invite_code})['af1_code'].append(promo_code)})
    │      │                       │                          │      │                     │                                └ '30I8YOlM'
    │      │                       │                          │      │                     └ '30I7ork0'
    │      │                       │                          │      └ <function MongoDB.find_one at 0x7f29ac0cf5e0>
    │      │                       │                          └ <utils.services.db.mongodb.MongoDB object at 0x7f29a5cf2d90>
    │      │                       └ '30I7ork0'
    │      └ <function MongoDB.update_one at 0x7f29ac0d1040>
    └ <utils.services.db.mongodb.MongoDB object at 0x7f29a5cf2d90>

TypeError: 'NoneType' object is not subscriptable
2021-06-08  :45:27 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-41' (164686), thread 'MainThread' (139817021249344):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f29af4b9c10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f29af67f310>
           └ <SpawnProcess name='SpawnProcess-41' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f29af67b940>
    └ <SpawnProcess name='SpawnProcess-41' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f29af44ea30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-41' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-41' parent=18601 started>
    │    └ <function subprocess_started at 0x7f29aeb82b80>
    └ <SpawnProcess name='SpawnProcess-41' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f29af44eb20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7f29aeb82160>
    │    │                  └ <uvicorn.server.Server object at 0x7f29af44eb20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7f29aeeca670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f29aeeca5e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f29aeecd160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f29aef3cee0>
    └ <Handle <TaskStepMethWrapper object at 0x7f29a439cac0>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7f29a439cac0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7f29a439cac0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7f29a439cac0>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f29aeaa43a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f29aeaa4430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f29aeacc550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f29a5d4a1c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f29aeacc550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f29a5d4ab20>
          └ <fastapi.applications.FastAPI object at 0x7f29a5d4a1c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f29a5ce4430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f29a5d4ab80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f29a5d4ab20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f29a5ce4430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f29a5d4abb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f29a5d4ab80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f29a4458ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f29a5d4a6d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f29a5d4abb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f29a4458ca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7f29adf49310>
          └ <fastapi.routing.APIRoute object at 0x7f29a5d4ab50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f29a4458ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f29a439ca90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f29a5d50790>
          └ <fastapi.routing.APIRoute object at 0x7f29a5d4ab50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f29a439ca60>
                     └ <function get_request_handler.<locals>.app at 0x7f29a5d501f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f29adfb93a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=15738361122, email_code='1234', phone_code=None, invite_code='30I8YOlM'), '...
                 │         └ <function login at 0x7f29a5d7da60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f29a5d4aa30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ '30I8YOlM'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=15738361122, email_code='1234', phone_code=None, invite_code='30I8YOlM')
    │         │        │          └ 3471188907746394112
    │         │        └ <function promo_code at 0x7f29a5e3df70>
    │         └ 3471188907746394112
    └ <function dnetworks at 0x7f29a5e3f700>

  File "./app/handler/user_handler.py", line 83, in dnetworks
    dnk_db.update_one({'own_code': pre2_code}, {'af2_code': dnk_db.find_one({'own_code': pre2_code})['af2_code'].append(promo_code)})
    │      │                       │                        │      │                     │                              └ '30I8-Kyw'
    │      │                       │                        │      │                     └ 'INTIAL'
    │      │                       │                        │      └ <function MongoDB.find_one at 0x7f29ac0cf5e0>
    │      │                       │                        └ <utils.services.db.mongodb.MongoDB object at 0x7f29a439cd90>
    │      │                       └ 'INTIAL'
    │      └ <function MongoDB.update_one at 0x7f29ac0d1040>
    └ <utils.services.db.mongodb.MongoDB object at 0x7f29a439cd90>

TypeError: 'NoneType' object is not subscriptable
2021-06-08  :48:18 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-42' (167096), thread 'MainThread' (140672244897600):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7ff0ce98dc10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7ff0ceb53310>
           └ <SpawnProcess name='SpawnProcess-42' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7ff0ceb4f940>
    └ <SpawnProcess name='SpawnProcess-42' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7ff0ce923a30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-42' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-42' parent=18601 started>
    │    └ <function subprocess_started at 0x7ff0ce056b80>
    └ <SpawnProcess name='SpawnProcess-42' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7ff0ce923b20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7ff0ce056160>
    │    │                  └ <uvicorn.server.Server object at 0x7ff0ce923b20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7ff0ce39e670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7ff0ce39e5e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7ff0ce3a1160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7ff0ce410ee0>
    └ <Handle <TaskStepMethWrapper object at 0x7ff0c51b5e80>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7ff0c51b5e80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7ff0c51b5e80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7ff0c51b5e80>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7ff0cdf783a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7ff0cdf78430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ff0cdfa0550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7ff0c520e1c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ff0cdfa0550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff0c520eb20>
          └ <fastapi.applications.FastAPI object at 0x7ff0c520e1c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7ff0c51a63a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7ff0c520eb80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff0c520eb20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7ff0c51a63a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7ff0c520ebb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7ff0c520eb80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff0c51a6430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7ff0c520e6d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7ff0c520ebb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff0c51a6430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7ff0cd41d310>
          └ <fastapi.routing.APIRoute object at 0x7ff0c520eb50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff0c51a6430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7ff0c51b5e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7ff0c5212790>
          └ <fastapi.routing.APIRoute object at 0x7ff0c520eb50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7ff0c51b5b20>
                     └ <function get_request_handler.<locals>.app at 0x7ff0c52121f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7ff0cd48d3a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=15738361122, email_code='1234', phone_code=None, invite_code='30I8YOlM'), '...
                 │         └ <function login at 0x7ff0c5240a60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7ff0c520ea30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ '30I8YOlM'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=15738361122, email_code='1234', phone_code=None, invite_code='30I8YOlM')
    │         │        │          └ 3471189623307239424
    │         │        └ <function promo_code at 0x7ff0c5301f70>
    │         └ 3471189623307239424
    └ <function dnetworks at 0x7ff0c5300700>

  File "./app/handler/user_handler.py", line 82, in dnetworks
    dnk_db.update_one({'own_code': invite_code}, {'af1_code': dnk_db.find_one({'own_code': invite_code})['af1_code'].append(promo_code)})
    │      │                       │                          │      │                     │                                └ '30I998Zg'
    │      │                       │                          │      │                     └ '30I8YOlM'
    │      │                       │                          │      └ <function MongoDB.find_one at 0x7ff0cc1673a0>
    │      │                       │                          └ <utils.services.db.mongodb.MongoDB object at 0x7ff0c51b5c10>
    │      │                       └ '30I8YOlM'
    │      └ <function MongoDB.update_one at 0x7ff0cc167dc0>
    └ <utils.services.db.mongodb.MongoDB object at 0x7ff0c51b5c10>

TypeError: 'NoneType' object is not subscriptable
2021-06-08  :52:18 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-45' (170436), thread 'MainThread' (140021358237504):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f5942ba9c10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f5942d6f310>
           └ <SpawnProcess name='SpawnProcess-45' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f5942d6b940>
    └ <SpawnProcess name='SpawnProcess-45' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f5942b3ea30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-45' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-45' parent=18601 started>
    │    └ <function subprocess_started at 0x7f5942275b80>
    └ <SpawnProcess name='SpawnProcess-45' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f5942b3eb20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7f5942275160>
    │    │                  └ <uvicorn.server.Server object at 0x7f5942b3eb20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7f59425ba670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f59425ba5e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f59425bd160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f594262cee0>
    └ <Handle <TaskStepMethWrapper object at 0x7f59393dde80>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7f59393dde80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7f59393dde80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7f59393dde80>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f59421943a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f5942194430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f59421bc550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f59394361c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f59421bc550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5939436b20>
          └ <fastapi.applications.FastAPI object at 0x7f59394361c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f59393ce3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f5939436b80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5939436b20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f59393ce3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5939436bb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f5939436b80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f59393ce430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f59394366d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5939436bb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f59393ce430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7f5941639310>
          └ <fastapi.routing.APIRoute object at 0x7f5939436b50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f59393ce430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f59393dde50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f593943a790>
          └ <fastapi.routing.APIRoute object at 0x7f5939436b50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f59393ddb20>
                     └ <function get_request_handler.<locals>.app at 0x7f593943a1f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f59416a93a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=15738361111, email_code='1234', phone_code=None, invite_code='30I998Zg'), '...
                 │         └ <function login at 0x7f5939468a60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f5939436a30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ '30I998Zg'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=15738361111, email_code='1234', phone_code=None, invite_code='30I998Zg')
    │         │        │          └ 3471190632783937536
    │         │        └ <function promo_code at 0x7f5939529f70>
    │         └ 3471190632783937536
    └ <function dnetworks at 0x7f5939528700>

  File "./app/handler/user_handler.py", line 85, in dnetworks
    dnk_db.update_one({'own_code': invite_code}, {'af1_code': dnk_db.find_one({'own_code': invite_code})['af1_code'].append(promo_code)})
    │      │                       │                          │      │                     │                                └ '30I9nR6M'
    │      │                       │                          │      │                     └ '30I998Zg'
    │      │                       │                          │      └ <function MongoDB.find_one at 0x7f59401463a0>
    │      │                       │                          └ <utils.services.db.mongodb.MongoDB object at 0x7f59393ddc10>
    │      │                       └ '30I998Zg'
    │      └ <function MongoDB.update_one at 0x7f5940146dc0>
    └ <utils.services.db.mongodb.MongoDB object at 0x7f59393ddc10>

TypeError: 'NoneType' object is not subscriptable
2021-06-08  :58:05 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-46' (175386), thread 'MainThread' (140432174790464):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fb8e94dbc10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fb8e96a1310>
           └ <SpawnProcess name='SpawnProcess-46' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fb8e969e940>
    └ <SpawnProcess name='SpawnProcess-46' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fb8e9471a30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-46' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-46' parent=18601 started>
    │    └ <function subprocess_started at 0x7fb8e8ba4b80>
    └ <SpawnProcess name='SpawnProcess-46' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fb8e9471b20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7fb8e8ba4160>
    │    │                  └ <uvicorn.server.Server object at 0x7fb8e9471b20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7fb8e8eec670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fb8e8eec5e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fb8e8eef160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fb8e8f5eee0>
    └ <Handle <TaskStepMethWrapper object at 0x7fb8d7d1de80>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7fb8d7d1de80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7fb8d7d1de80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7fb8d7d1de80>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fb8e8ac63a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fb8e8ac6430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb8e8aee550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fb8d7d761c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb8e8aee550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb8d7d76b20>
          └ <fastapi.applications.FastAPI object at 0x7fb8d7d761c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fb8d7d0e3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7fb8d7d76b80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb8d7d76b20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fb8d7d0e3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb8d7d76bb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7fb8d7d76b80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb8d7d0e430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fb8d7d766d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb8d7d76bb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb8d7d0e430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7fb8e7f6b310>
          └ <fastapi.routing.APIRoute object at 0x7fb8d7d76b50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb8d7d0e430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb8d7d1de50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fb8d7d7a790>
          └ <fastapi.routing.APIRoute object at 0x7fb8d7d76b50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fb8d7d1db20>
                     └ <function get_request_handler.<locals>.app at 0x7fb8d7d7a1f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fb8e7fdb3a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=15738365611, email_code='1234', phone_code=None, invite_code='30I9nR6M'), '...
                 │         └ <function login at 0x7fb8d7da8a60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7fb8d7d76a30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ '30I9nR6M'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=15738365611, email_code='1234', phone_code=None, invite_code='30I9nR6M')
    │         │        │          └ 3471192085225275392
    │         │        └ <function promo_code at 0x7fb8d7e69f70>
    │         └ 3471192085225275392
    └ <function dnetworks at 0x7fb8d7e68700>

  File "./app/handler/user_handler.py", line 86, in dnetworks
    dnk_db.update_one({'own_code': invite_code}, {'af1_code': dnk_db.find_one({'own_code': invite_code})['af1_code'].append(promo_code)})
    │      │                       │                          │      │                     │                                └ '30I9IZP0'
    │      │                       │                          │      │                     └ '30I9nR6M'
    │      │                       │                          │      └ <function MongoDB.find_one at 0x7fb8e5abb3a0>
    │      │                       │                          └ <utils.services.db.mongodb.MongoDB object at 0x7fb8d7d1dc10>
    │      │                       └ '30I9nR6M'
    │      └ <function MongoDB.update_one at 0x7fb8e5abbdc0>
    └ <utils.services.db.mongodb.MongoDB object at 0x7fb8d7d1dc10>

TypeError: 'NoneType' object is not subscriptable
2021-06-08  :04:30 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-47' (179981), thread 'MainThread' (140155158959936):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f7869dfac10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f7869fbf310>
           └ <SpawnProcess name='SpawnProcess-47' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f7869fbb940>
    └ <SpawnProcess name='SpawnProcess-47' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f7869d8fa30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-47' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-47' parent=18601 started>
    │    └ <function subprocess_started at 0x7f78694c2b80>
    └ <SpawnProcess name='SpawnProcess-47' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f7869d8fb20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7f78694c2160>
    │    │                  └ <uvicorn.server.Server object at 0x7f7869d8fb20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7f786980a670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f786980a5e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f786980d160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f786987cee0>
    └ <Handle <TaskStepMethWrapper object at 0x7f786463deb0>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7f786463deb0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7f786463deb0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7f786463deb0>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f78693e43a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f78693e4430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f786940c550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f78646961c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f786940c550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f7864696b20>
          └ <fastapi.applications.FastAPI object at 0x7f78646961c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f786462e3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f7864696b80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f7864696b20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f786462e3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f7864696bb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f7864696b80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f786462e430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f78646966d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f7864696bb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f786462e430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7f786888a310>
          └ <fastapi.routing.APIRoute object at 0x7f7864696b50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f786462e430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f786463de80>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f786469a790>
          └ <fastapi.routing.APIRoute object at 0x7f7864696b50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f786463db50>
                     └ <function get_request_handler.<locals>.app at 0x7f786469a1f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f78688f93a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=15738365867, email_code='1234', phone_code=None, invite_code='INTIAL'), 're...
                 │         └ <function login at 0x7f78646c8a60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f7864696a30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ 'INTIAL'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=15738365867, email_code='1234', phone_code=None, invite_code='INTIAL')
    │         │        │          └ 3471193700426579968
    │         │        └ <function promo_code at 0x7f7864789f70>
    │         └ 3471193700426579968
    └ <function dnetworks at 0x7f7864788700>

  File "./app/handler/user_handler.py", line 85, in dnetworks
    if pre2_info['af1_code'] != 'INTIAL':
       └ None

TypeError: 'NoneType' object is not subscriptable
2021-06-08  :08:53 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-48' (183519), thread 'MainThread' (139914128877376):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f404b5c6c10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f404b78c310>
           └ <SpawnProcess name='SpawnProcess-48' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f404b788940>
    └ <SpawnProcess name='SpawnProcess-48' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f404b55ba30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-48' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-48' parent=18601 started>
    │    └ <function subprocess_started at 0x7f404ac92b80>
    └ <SpawnProcess name='SpawnProcess-48' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f404b55bb20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7f404ac92160>
    │    │                  └ <uvicorn.server.Server object at 0x7f404b55bb20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7f404afd7670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f404afd75e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f404afda160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f404b049ee0>
    └ <Handle <TaskStepMethWrapper object at 0x7f40404a68b0>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7f40404a68b0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7f40404a68b0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7f40404a68b0>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f404abb33a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f404abb3430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f404abd9550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f4041e4e1c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f404abd9550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f4041e4eb20>
          └ <fastapi.applications.FastAPI object at 0x7f4041e4e1c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f4041de6430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f4041e4eb80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f4041e4eb20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f4041de6430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f4041e4ebb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f4041e4eb80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4040581040>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f4041e4e6d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f4041e4ebb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4040581040>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7f404a056310>
          └ <fastapi.routing.APIRoute object at 0x7f4041e4eb50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4040581040>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f40404a67f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f4041e52790>
          └ <fastapi.routing.APIRoute object at 0x7f4041e4eb50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f40404a6880>
                     └ <function get_request_handler.<locals>.app at 0x7f4041e521f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f404a0c63a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=122345123457, email_code='1234', phone_code=None, invite_code='30Iaja8M'), ...
                 │         └ <function login at 0x7f4041e80a60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f4041e4ea30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ '30Iaja8M'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=122345123457, email_code='1234', phone_code=None, invite_code='30Iaja8M')
    │         │        │          └ 3471194805013315584
    │         │        └ <function promo_code at 0x7f4041f41f70>
    │         └ 3471194805013315584
    └ <function dnetworks at 0x7f4041f40700>

  File "./app/handler/user_handler.py", line 85, in dnetworks
    dnk_db.update_one({'own_code': invite_code}, {'af1_code': af1_codes.append(promo_code)})
    │      │                       │                                           └ '30IakyP0'
    │      │                       └ '30Iaja8M'
    │      └ <function MongoDB.update_one at 0x7f4043b91dc0>
    └ <utils.services.db.mongodb.MongoDB object at 0x7f40404a6c40>

UnboundLocalError: local variable 'af1_codes' referenced before assignment
2021-06-08  :11:15 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-49' (185933), thread 'MainThread' (140052327266112):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f6078a07c10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f6078bcd310>
           └ <SpawnProcess name='SpawnProcess-49' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f6078bc9940>
    └ <SpawnProcess name='SpawnProcess-49' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f607899ca30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-49' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-49' parent=18601 started>
    │    └ <function subprocess_started at 0x7f60780d0b80>
    └ <SpawnProcess name='SpawnProcess-49' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f607899cb20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7f60780d0160>
    │    │                  └ <uvicorn.server.Server object at 0x7f607899cb20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7f6078418670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f60784185e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f607841b160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f607848aee0>
    └ <Handle <TaskStepMethWrapper object at 0x7f607424ee80>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7f607424ee80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7f607424ee80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7f607424ee80>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f6077ff23a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f6077ff2430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f607801a550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f60742a71c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f607801a550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f60742a7b20>
          └ <fastapi.applications.FastAPI object at 0x7f60742a71c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f607423f3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f60742a7b80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f60742a7b20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f607423f3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f60742a7bb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f60742a7b80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f607423f430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f60742a76d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f60742a7bb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f607423f430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7f6077497310>
          └ <fastapi.routing.APIRoute object at 0x7f60742a7b50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f607423f430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f607424ee50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f60742ab790>
          └ <fastapi.routing.APIRoute object at 0x7f60742a7b50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f607424eb20>
                     └ <function get_request_handler.<locals>.app at 0x7f60742ab1f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f60775073a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=12756745123457, email_code='1234', phone_code=None, invite_code='30IakyP0')...
                 │         └ <function login at 0x7f60742d8a60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f60742a7a30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ '30IakyP0'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=12756745123457, email_code='1234', phone_code=None, invite_code='30IakyP0')
    │         │        │          └ 3471195403599216640
    │         │        └ <function promo_code at 0x7f6074399f70>
    │         └ 3471195403599216640
    └ <function dnetworks at 0x7f6074398700>

  File "./app/handler/user_handler.py", line 86, in dnetworks
    dnk_db.update_one({'own_code': invite_code}, {'af1_code': af1_codes.append(promo_code)})
    │      │                       │                                           └ '30Iatghw'
    │      │                       └ '30IakyP0'
    │      └ <function MongoDB.update_one at 0x7f6074fe7dc0>
    └ <utils.services.db.mongodb.MongoDB object at 0x7f607424ec10>

UnboundLocalError: local variable 'af1_codes' referenced before assignment
2021-06-08  :14:13 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-50' (187944), thread 'MainThread' (139631087302464):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7efe64c4bc10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7efe64e11310>
           └ <SpawnProcess name='SpawnProcess-50' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7efe64e0d940>
    └ <SpawnProcess name='SpawnProcess-50' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7efe64be1a30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-50' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-50' parent=18601 started>
    │    └ <function subprocess_started at 0x7efe64317b80>
    └ <SpawnProcess name='SpawnProcess-50' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7efe64be1b20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7efe64317160>
    │    │                  └ <uvicorn.server.Server object at 0x7efe64be1b20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7efe6465c670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7efe6465c5e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7efe6465f160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7efe646ceee0>
    └ <Handle <TaskStepMethWrapper object at 0x7efe53472e80>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7efe53472e80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7efe53472e80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7efe53472e80>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7efe642363a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7efe64236430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efe6425e550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7efe534ca1c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efe6425e550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efe534cab20>
          └ <fastapi.applications.FastAPI object at 0x7efe534ca1c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7efe534613a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7efe534cab80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efe534cab20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7efe534613a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7efe534cabb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7efe534cab80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe53461430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7efe534ca6d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7efe534cabb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe53461430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7efe636db310>
          └ <fastapi.routing.APIRoute object at 0x7efe534cab50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe53461430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7efe53472e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7efe534ce790>
          └ <fastapi.routing.APIRoute object at 0x7efe534cab50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7efe53472b20>
                     └ <function get_request_handler.<locals>.app at 0x7efe534ce1f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7efe6374b3a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=12756745112457, email_code='1234', phone_code=None, invite_code='30Iatghw')...
                 │         └ <function login at 0x7efe534fca60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7efe534caa30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ '30Iatghw'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=12756745112457, email_code='1234', phone_code=None, invite_code='30Iatghw')
    │         │        │          └ 3471196148750876672
    │         │        └ <function promo_code at 0x7efe535bdf70>
    │         └ 3471196148750876672
    └ <function dnetworks at 0x7efe535bc700>

  File "./app/handler/user_handler.py", line 88, in dnetworks
    dnk_db.update_one({'own_code': invite_code}, {'af1_code': af1_codes.append(promo_code)})
    │      │                       │                                           └ '30IaE6g0'
    │      │                       └ '30Iatghw'
    │      └ <function MongoDB.update_one at 0x7efe6122bdc0>
    └ <utils.services.db.mongodb.MongoDB object at 0x7efe53472c10>

UnboundLocalError: local variable 'af1_codes' referenced before assignment
2021-06-08  :17:18 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-51' (190762), thread 'MainThread' (140413721859904):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fb49d6c5c10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fb49d88b310>
           └ <SpawnProcess name='SpawnProcess-51' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fb49d887940>
    └ <SpawnProcess name='SpawnProcess-51' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fb49d65aa30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-51' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-51' parent=18601 started>
    │    └ <function subprocess_started at 0x7fb49cd8eb80>
    └ <SpawnProcess name='SpawnProcess-51' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fb49d65ab20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7fb49cd8e160>
    │    │                  └ <uvicorn.server.Server object at 0x7fb49d65ab20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7fb49d0d6670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fb49d0d65e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fb49d0d9160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fb49d148ee0>
    └ <Handle <TaskStepMethWrapper object at 0x7fb48bed4e80>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7fb48bed4e80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7fb48bed4e80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7fb48bed4e80>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fb49ccb23a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fb49ccb2430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb49ccd8550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fb48bf2d1c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb49ccd8550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb48bf2db20>
          └ <fastapi.applications.FastAPI object at 0x7fb48bf2d1c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fb48bec53a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7fb48bf2db80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb48bf2db20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fb48bec53a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb48bf2dbb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7fb48bf2db80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb48bec5430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fb48bf2d6d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb48bf2dbb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb48bec5430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7fb49c155310>
          └ <fastapi.routing.APIRoute object at 0x7fb48bf2db50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb48bec5430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7fb48bed4e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fb48bf31790>
          └ <fastapi.routing.APIRoute object at 0x7fb48bf2db50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fb48bed4b20>
                     └ <function get_request_handler.<locals>.app at 0x7fb48bf311f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fb49c1c53a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=12715112457, email_code='1234', phone_code=None, invite_code='30IaE6g0'), '...
                 │         └ <function login at 0x7fb48bf5fa60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7fb48bf2da30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ '30IaE6g0'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=12715112457, email_code='1234', phone_code=None, invite_code='30IaE6g0')
    │         │        │          └ 3471196922427998208
    │         │        └ <function promo_code at 0x7fb498055f70>
    │         └ 3471196922427998208
    └ <function dnetworks at 0x7fb498054700>

  File "./app/handler/user_handler.py", line 89, in dnetworks
    dnk_db.update_one({'own_code': invite_code}, {'af1_code': af1_codes.append(promo_code)})
    │      │                       │                                           └ '30IaPmOM'
    │      │                       └ '30IaE6g0'
    │      └ <function MongoDB.update_one at 0x7fb499ca5dc0>
    └ <utils.services.db.mongodb.MongoDB object at 0x7fb48bed4c10>

UnboundLocalError: local variable 'af1_codes' referenced before assignment
2021-06-08  :18:27 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-52' (191523), thread 'MainThread' (139679226181440):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f099a11bc10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f099a2e1310>
           └ <SpawnProcess name='SpawnProcess-52' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f099a2dd940>
    └ <SpawnProcess name='SpawnProcess-52' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f099a0b1a30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-52' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-52' parent=18601 started>
    │    └ <function subprocess_started at 0x7f09997e4b80>
    └ <SpawnProcess name='SpawnProcess-52' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f099a0b1b20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7f09997e4160>
    │    │                  └ <uvicorn.server.Server object at 0x7f099a0b1b20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7f0999b2c670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f0999b2c5e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f0999b2f160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f0999b9eee0>
    └ <Handle <TaskStepMethWrapper object at 0x7f0994960e80>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7f0994960e80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7f0994960e80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7f0994960e80>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f09997003a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f0999700430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f099972e550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f09949b81c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f099972e550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f09949b8b20>
          └ <fastapi.applications.FastAPI object at 0x7f09949b81c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f099494f3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f09949b8b80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f09949b8b20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f099494f3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f09949b8bb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f09949b8b80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f099494f430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f09949b86d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f09949b8bb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f099494f430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7f0998bab310>
          └ <fastapi.routing.APIRoute object at 0x7f09949b8b50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f099494f430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f0994960e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f09949bc790>
          └ <fastapi.routing.APIRoute object at 0x7f09949b8b50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f0994960b20>
                     └ <function get_request_handler.<locals>.app at 0x7f09949bc1f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f0998c1b3a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=1245456457, email_code='1234', phone_code=None, invite_code='30IaPmOM'), 'r...
                 │         └ <function login at 0x7f09949eaa60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f09949b8a30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ '30IaPmOM'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=1245456457, email_code='1234', phone_code=None, invite_code='30IaPmOM')
    │         │        │          └ 3471197213936320512
    │         │        └ <function promo_code at 0x7f0994aabf70>
    │         └ 3471197213936320512
    └ <function dnetworks at 0x7f0994aaa700>

  File "./app/handler/user_handler.py", line 89, in dnetworks
    dnk_db.update_one({'own_code': invite_code}, {'af1_code': af1_codes.append(promo_code)})
    │      │                       │                                           └ '30IaTCi0'
    │      │                       └ '30IaPmOM'
    │      └ <function MongoDB.update_one at 0x7f09966fbdc0>
    └ <utils.services.db.mongodb.MongoDB object at 0x7f0994960c10>

UnboundLocalError: local variable 'af1_codes' referenced before assignment
2021-06-08  :26:28 - ERROR - user.py - 50 - An error has been caught in function 'login', process 'SpawnProcess-54' (198315), thread 'MainThread' (140234932815680):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f8afcc40c10>
  File "/usr/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f8afce06310>
           └ <SpawnProcess name='SpawnProcess-54' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f8afce02940>
    └ <SpawnProcess name='SpawnProcess-54' parent=18601 started>
  File "/usr/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f8afcbd5a30>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-54' parent=18601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-54' parent=18601 started>
    │    └ <function subprocess_started at 0x7f8afc309b80>
    └ <SpawnProcess name='SpawnProcess-54' parent=18601 started>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f8afcbd5b20>>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/server.py", line 50, in run
    loop.run_until_complete(self.serve(sockets=sockets))
    │    │                  │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8888)>]
    │    │                  │    └ <function Server.serve at 0x7f8afc309160>
    │    │                  └ <uvicorn.server.Server object at 0x7f8afcbd5b20>
    │    └ <function BaseEventLoop.run_until_complete at 0x7f8afc651670>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 603, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f8afc6515e0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f8afc654160>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f8afc6c3ee0>
    └ <Handle <TaskStepMethWrapper object at 0x7f8aeb472e80>()>
  File "/usr/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x7f8aeb472e80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x7f8aeb472e80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x7f8aeb472e80>()>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/protocols/http/h11_impl.py", line 369, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f8afc2253a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f8afc225430>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f8afc253550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 59, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f8aeb4cb1c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f8afc253550>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f8aeb4cbb20>
          └ <fastapi.applications.FastAPI object at 0x7f8aeb4cb1c0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f8aeb4633a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f8aeb4cbb80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f8aeb4cbb20>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/middleware/cors.py", line 78, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f8aeb4633a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f8aeb4cbbb0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f8aeb4cbb80>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f8aeb463430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f8aeb4cb6d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f8aeb4cbbb0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 580, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f8aeb463430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │     └ <function Route.handle at 0x7f8afb6d0310>
          └ <fastapi.routing.APIRoute object at 0x7f8aeb4cbb50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 241, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f8aeb463430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x7f8aeb472e50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8888), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f8aeb4cf790>
          └ <fastapi.routing.APIRoute object at 0x7f8aeb4cbb50>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/starlette/routing.py", line 52, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f8aeb472b20>
                     └ <function get_request_handler.<locals>.app at 0x7f8aeb4cf1f0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f8afb7403a0>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_info': UserRegisterLogin(email=None, phone=1245987976457, email_code='1234', phone_code=None, invite_code='30IaTCi0'),...
                 │         └ <function login at 0x7f8aeb4fca60>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f8aeb4cba30>

> File "./app/api/user.py", line 50, in login
    dnetworks(user_id, promo_code(user_id), user_info.invite_code)
    │         │        │          │         │         └ '30IaTCi0'
    │         │        │          │         └ UserRegisterLogin(email=None, phone=1245987976457, email_code='1234', phone_code=None, invite_code='30IaTCi0')
    │         │        │          └ 3471199232159907840
    │         │        └ <function promo_code at 0x7f8aeb5bdf70>
    │         └ 3471199232159907840
    └ <function dnetworks at 0x7f8aeb5bc700>

  File "./app/handler/user_handler.py", line 71, in dnetworks
    pre2_code = pre1_info['pr1_code']
                └ {'user_id': 3471197213936320512, 'own_code': '30IaTCi0', 'pre1_code': '30IaPmOM', 'pre2_code': 'INTIAL', 'af1_code': [], 'af2...

KeyError: 'pr1_code'
2021-06-08  :58:26 - ERROR - auth.py - 43 - An error has been caught in function 'verify_request', process 'SpawnProcess-61' (218478), thread 'ThreadPoolExecutor-1_0' (139962324555328):
Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f4b8a3d5c10>
    └ <Thread(ThreadPoolExecutor-1_0, started daemon 139962324555328)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f4b8a3d5940>
    └ <Thread(ThreadPoolExecutor-1_0, started daemon 139962324555328)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ThreadPoolExecutor-1_0, started daemon 139962324555328)>
    │    │        │    └ (<weakref at 0x7f4b84a47900; to 'ThreadPoolExecutor' at 0x7f4b84a44e20>, <_queue.SimpleQueue object at 0x7f4b84a474f0>, None,...
    │    │        └ <Thread(ThreadPoolExecutor-1_0, started daemon 139962324555328)>
    │    └ <function _worker at 0x7f4b84c1c280>
    └ <Thread(ThreadPoolExecutor-1_0, started daemon 139962324555328)>
  File "/usr/lib/python3.8/concurrent/futures/thread.py", line 80, in _worker
    work_item.run()
    │         └ <function _WorkItem.run at 0x7f4b84c1c3a0>
    └ <concurrent.futures.thread._WorkItem object at 0x7f4b84a521f0>
  File "/usr/lib/python3.8/concurrent/futures/thread.py", line 57, in run
    result = self.fn(*self.args, **self.kwargs)
             │    │   │    │       │    └ {}
             │    │   │    │       └ <concurrent.futures.thread._WorkItem object at 0x7f4b84a521f0>
             │    │   │    └ [functools.partial(<function antx_auth at 0x7f4b867ee040>, request=<starlette.requests.Request object at 0x7f4b84a44a60>)]
             │    │   └ <concurrent.futures.thread._WorkItem object at 0x7f4b84a521f0>
             │    └ <built-in method run of Context object at 0x7f4b84a48f80>
             └ <concurrent.futures.thread._WorkItem object at 0x7f4b84a521f0>

  File "./utils/services/base/base_func.py", line 51, in antx_auth
    return auth_required(request=request)
           │                     └ <starlette.requests.Request object at 0x7f4b84a44a60>
           └ <function auth_required at 0x7f4b867e7040>

  File "./utils/services/auth/antx_auth.py", line 27, in auth_required
    status, auth_token = Auth.verify_request(request)
                         │    │              └ <starlette.requests.Request object at 0x7f4b84a44a60>
                         │    └ <function verify_request at 0x7f4b8892b9d0>
                         └ <module 'utils.services.auth.auth' from './utils/services/auth/auth.py'>

> File "./utils/services/auth/auth.py", line 43, in verify_request
    return verify_authtoken(token)
           │                └ 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MjMwMzEyNDksImV4cCI6MTYyMzYzNjA0OSwic2NvcGVzIjpbIm9wZW4iXSwiaWRlbnRpdHkiOiJ...
           └ <function verify_authtoken at 0x7f4b8892b670>

  File "./utils/services/auth/auth.py", line 32, in verify_authtoken
    payload = jwt.decode(token, CONFIG['SALT'], algorithms=['HS256'])
              │   │      │      └ {'IDENTITY': ['bc-app', 'bc-web'], 'SALT': '795542400000'}
              │   │      └ 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MjMwMzEyNDksImV4cCI6MTYyMzYzNjA0OSwic2NvcGVzIjpbIm9wZW4iXSwiaWRlbnRpdHkiOiJ...
              │   └ <bound method PyJWT.decode of <jwt.api_jwt.PyJWT object at 0x7f4b88953070>>
              └ <module 'jwt' from '/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/__init__.py'>

  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/api_jwt.py", line 119, in decode
    decoded = self.decode_complete(jwt, key, algorithms, options, **kwargs)
              │    │               │    │    │           │          └ {}
              │    │               │    │    │           └ None
              │    │               │    │    └ ['HS256']
              │    │               │    └ '795542400000'
              │    │               └ 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MjMwMzEyNDksImV4cCI6MTYyMzYzNjA0OSwic2NvcGVzIjpbIm9wZW4iXSwiaWRlbnRpdHkiOiJ...
              │    └ <function PyJWT.decode_complete at 0x7f4b8894ff70>
              └ <jwt.api_jwt.PyJWT object at 0x7f4b88953070>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/api_jwt.py", line 90, in decode_complete
    decoded = api_jws.decode_complete(
              │       └ <bound method PyJWS.decode_complete of <jwt.api_jws.PyJWS object at 0x7f4b88949580>>
              └ <module 'jwt.api_jws' from '/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/api_jws.py'>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/api_jws.py", line 149, in decode_complete
    self._verify_signature(signing_input, header, signature, key, algorithms)
    │    │                 │              │       │          │    └ ['HS256']
    │    │                 │              │       │          └ '795542400000'
    │    │                 │              │       └ b'\xcb\xbc\x1d\xc1^M]b\x17\xae\x88\x1c\xf4\xf6\xa0\xce\xee\x9c\xe1\xff\x10)\x86)\x07`\x00\xee0\\\xc1"'
    │    │                 │              └ {'typ': 'JWT', 'alg': 'HS256'}
    │    │                 └ b'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MjMwMzEyNDksImV4cCI6MTYyMzYzNjA0OSwic2NvcGVzIjpbIm9wZW4iXSwiaWRlbnRpdHkiOi...
    │    └ <function PyJWS._verify_signature at 0x7f4b8894fa60>
    └ <jwt.api_jws.PyJWS object at 0x7f4b88949580>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/api_jws.py", line 236, in _verify_signature
    raise InvalidSignatureError("Signature verification failed")
          └ <class 'jwt.exceptions.InvalidSignatureError'>

jwt.exceptions.InvalidSignatureError: Signature verification failed
2021-06-08  :01:06 - ERROR - auth.py - 43 - An error has been caught in function 'verify_request', process 'SpawnProcess-62' (222953), thread 'ThreadPoolExecutor-1_0' (140089745204800):
Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f6941218c10>
    └ <Thread(ThreadPoolExecutor-1_0, started daemon 140089745204800)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f6941218940>
    └ <Thread(ThreadPoolExecutor-1_0, started daemon 140089745204800)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ThreadPoolExecutor-1_0, started daemon 140089745204800)>
    │    │        │    └ (<weakref at 0x7f693c08b900; to 'ThreadPoolExecutor' at 0x7f693c088af0>, <_queue.SimpleQueue object at 0x7f693c08b4f0>, None,...
    │    │        └ <Thread(ThreadPoolExecutor-1_0, started daemon 140089745204800)>
    │    └ <function _worker at 0x7f693c261310>
    └ <Thread(ThreadPoolExecutor-1_0, started daemon 140089745204800)>
  File "/usr/lib/python3.8/concurrent/futures/thread.py", line 80, in _worker
    work_item.run()
    │         └ <function _WorkItem.run at 0x7f693c261430>
    └ <concurrent.futures.thread._WorkItem object at 0x7f693c095160>
  File "/usr/lib/python3.8/concurrent/futures/thread.py", line 57, in run
    result = self.fn(*self.args, **self.kwargs)
             │    │   │    │       │    └ {}
             │    │   │    │       └ <concurrent.futures.thread._WorkItem object at 0x7f693c095160>
             │    │   │    └ [functools.partial(<function antx_auth at 0x7f693d6310d0>, request=<starlette.requests.Request object at 0x7f693c088ca0>)]
             │    │   └ <concurrent.futures.thread._WorkItem object at 0x7f693c095160>
             │    └ <built-in method run of Context object at 0x7f693c09a040>
             └ <concurrent.futures.thread._WorkItem object at 0x7f693c095160>

  File "./utils/services/base/base_func.py", line 51, in antx_auth
    return auth_required(request=request)
           │                     └ <starlette.requests.Request object at 0x7f693c088ca0>
           └ <function auth_required at 0x7f693d62a0d0>

  File "./utils/services/auth/antx_auth.py", line 27, in auth_required
    status, auth_token = Auth.verify_request(request)
                         │    │              └ <starlette.requests.Request object at 0x7f693c088ca0>
                         │    └ <function verify_request at 0x7f693f76da60>
                         └ <module 'utils.services.auth.auth' from './utils/services/auth/auth.py'>

> File "./utils/services/auth/auth.py", line 43, in verify_request
    return verify_authtoken(token)
           │                └ 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MjMwMzEyNDksImV4cCI6MTYyMzYzNjA0OSwic2NvcGVzIjpbIm9wZW4iXSwiaWRlbnRpdHkiOiJ...
           └ <function verify_authtoken at 0x7f693f76d700>

  File "./utils/services/auth/auth.py", line 32, in verify_authtoken
    payload = jwt.decode(token, CONFIG['SALT'], algorithms=['HS256'])
              │   │      │      └ {'IDENTITY': ['bc-app', 'bc-web'], 'SALT': '795542400000'}
              │   │      └ 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MjMwMzEyNDksImV4cCI6MTYyMzYzNjA0OSwic2NvcGVzIjpbIm9wZW4iXSwiaWRlbnRpdHkiOiJ...
              │   └ <bound method PyJWT.decode of <jwt.api_jwt.PyJWT object at 0x7f693f79b070>>
              └ <module 'jwt' from '/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/__init__.py'>

  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/api_jwt.py", line 119, in decode
    decoded = self.decode_complete(jwt, key, algorithms, options, **kwargs)
              │    │               │    │    │           │          └ {}
              │    │               │    │    │           └ None
              │    │               │    │    └ ['HS256']
              │    │               │    └ '795542400000'
              │    │               └ 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MjMwMzEyNDksImV4cCI6MTYyMzYzNjA0OSwic2NvcGVzIjpbIm9wZW4iXSwiaWRlbnRpdHkiOiJ...
              │    └ <function PyJWT.decode_complete at 0x7f693f79c040>
              └ <jwt.api_jwt.PyJWT object at 0x7f693f79b070>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/api_jwt.py", line 90, in decode_complete
    decoded = api_jws.decode_complete(
              │       └ <bound method PyJWS.decode_complete of <jwt.api_jws.PyJWS object at 0x7f693f78c580>>
              └ <module 'jwt.api_jws' from '/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/api_jws.py'>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/api_jws.py", line 149, in decode_complete
    self._verify_signature(signing_input, header, signature, key, algorithms)
    │    │                 │              │       │          │    └ ['HS256']
    │    │                 │              │       │          └ '795542400000'
    │    │                 │              │       └ b'\xcb\xbc\x1d\xc1^M]b\x17\xae\x88\x1c\xf4\xf6\xa0\xce\xee\x9c\xe1\xff\x10)\x86)\x07`\x00\xee0\\\xc1"'
    │    │                 │              └ {'typ': 'JWT', 'alg': 'HS256'}
    │    │                 └ b'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MjMwMzEyNDksImV4cCI6MTYyMzYzNjA0OSwic2NvcGVzIjpbIm9wZW4iXSwiaWRlbnRpdHkiOi...
    │    └ <function PyJWS._verify_signature at 0x7f693f791af0>
    └ <jwt.api_jws.PyJWS object at 0x7f693f78c580>
  File "/home/antx/Code/antx.funcode/py3.code/BcAppAPI/venv/lib/python3.8/site-packages/jwt/api_jws.py", line 236, in _verify_signature
    raise InvalidSignatureError("Signature verification failed")
          └ <class 'jwt.exceptions.InvalidSignatureError'>

jwt.exceptions.InvalidSignatureError: Signature verification failed
